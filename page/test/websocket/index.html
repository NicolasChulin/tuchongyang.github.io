<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>精美CSS3聊天窗口DEMO演示</title>
    <link rel="stylesheet" href="assets/css/style.css" media="screen" type="text/css" />
</head>

<body>
    <div class="header">
        <div class="clients">聊天人数:1</div>
        <div class="state">连接状态:1</div>
    </div>
    <div id="convo" data-from="Sonu Joshi">
        <ul class="chat-thread wraper">
            <li>Are we meeting today?</li>
        </ul>
    </div>
    <div class="footer">
        <div class="submit" id="submit">发送</div>
        <div class="uhead"></div>
        <div class="edit-area" id="message" contenteditable=""></div>
    </div>
<script src='assets/jquery.js'></script>
<script type="text/javascript"> 
    var ws = new WebSocket("ws://192.168.1.29:3000?t=test");  
ws.onopen = function() { 
    console.log("连接状态", ws);  
    var state = ws.readyState==0?'未连接':ws.readyState==1?'已连接':ws.readyState==2?'正在关闭':ws.readyState==3?'已关闭':ws.readyState;
    $(".header state").html("连接状态: " + state);  
     
};  
ws.onmessage = function(evt) { 
    console.log(evt.data) 
    var data = JSON.parse(evt.data);
    if(data.clients){
        $('.header .clients').html('聊天人数:'+data.clients);
    }else if(data.chart){
        $('.chat-thread').append('<li>'+data.chart.content+'</li>')
    } 
};  
ws.onclose = function(evt) {  
    console.log("WebSocketClosed!");  
    console.log(evt);  
};  
ws.onerror = function(evt) {  
    console.log("WebSocketError!");  
};  

document.getElementById("submit").onclick = send;
function send() {  
    var msg = $("#message").html();  
    var key = $("#token").val();  
    var name = $("#name").val(); 
    var strObj = {
        chart:{
            content: msg
        }
    }; 
    var str = JSON.stringify(strObj);  
    console.log("发送", str);  
    ws.send(str);  
};  
  
function exit() {  
    var r = ws.close();  
    console.log("退出", r);  
}  
</script>
</body>

</html>